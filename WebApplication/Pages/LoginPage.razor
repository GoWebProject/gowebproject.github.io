@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web;
@using Microsoft.AspNetCore.Identity
@page "/LoginPage"
@using Microsoft.JSInterop;
@using WebApplication.Models
@using WebApplication.Services
@inject IJSRuntime JsRuntime;
@inject NavigationManager _navigationManager;
@inject AccountManagerService _accountManager;

<form>
    <label for="login">Логин/Почта:</label><br>
    <input style="width: auto; " class="form-control input_user" @bind="_login" type="text" id="login"><br><br>
    <label for="password">Пароль:</label><br>
    <input style="width: auto; " class="form-control input_user" @bind="_pwd" type="password" id="password"><br><br>
</form>
<button class="btn btn-primary" @onclick="OnSubmitButtonClick">Войти</button>
<div class="mt-4">
    <div class="d-flex links">
        Нет аккаунта? <a href="/RegistrationPage" class="ml-2">Регистрация</a>
    </div>
    <div class="d-flex links">
        <a href="#">Забыли пароль?</a>
    </div>
</div>

@code{
    private string _login;
    private string _pwd;

    protected override Task OnInitializedAsync()
    {
        if (_accountManager.LoggedUser != null)
        {
            _navigationManager.NavigateTo("/Profile");
        }
        return base.OnInitializedAsync();
    }

    private void OnSubmitButtonClick()
    {
        _accountManager.LoggedUser = UserManager.GetUser(_login, _pwd);
        if (_accountManager.LoggedUser == null)
        {
            JsRuntime.InvokeVoidAsync("alert", "Неправильный логин или пароль!");
        }
        else
        {
            _navigationManager.NavigateTo("/Profile");
        }
    }

}